# P3 Research Findings â€” OVI Native Mobile
*Generated by LG2 during Research Mode (Roll 14) â€” 2026-02-18 14:19 UTC*

---

## Investigation: P3.1 â€” Expo/React Native Scaffold

### What We Have (Phase 2 Review)
The existing `ovi-pwa` (React 19 + Vite 7) provides:
- `useOVI` â€” HTTP polling + message state (backend: Express proxy â†’ OpenClaw gateway)
- `useTTS` â€” ElevenLabs fetch â†’ `<Audio>` playback (browser Web Audio API)
- `useSpeech` â€” Web Speech API + Whisper fallback
- Components: `VoiceButton`, `MessageFeed`, `StatusBar`
- Backend: `server/index.js` (Express, handles /api/chat, /api/tts, /api/status)

### Tooling Available on Server
- `npx` (v11.8.0) âœ… â€” can run `create-expo-app` on demand
- Node v25.5.0 âœ…
- Expo CLI: **not installed globally** â€” use via `npx create-expo-app@latest`

### Recommended Scaffold Command (P3.1)
```bash
cd /root/.openclaw/workspace/sparks
npx create-expo-app@latest ovi-native --template blank-typescript
```

### Architecture Decision: Monorepo Strategy
**Recommendation:** Keep `ovi-native` as a sibling to `ovi-pwa` in `/sparks/`.
- Shared types can live in `ovi-pwa/src/hooks/useOVI.ts` interface definitions (copy for now, extract to shared package later if needed)
- Backend API server (`ovi-pwa/server/`) stays shared â€” native app hits the same endpoints

### Code Portability Analysis
| PWA Module | React Native Equivalent | Status |
|---|---|---|
| `useOVI.ts` | Portable â€” pure fetch/state, no DOM | âœ… Direct copy |
| `useTTS.ts` | Replace `new Audio()` with `expo-av` `Sound` | ğŸ”„ Adapt |
| `useSpeech.ts` | Replace Web Speech API with `expo-audio` + Whisper | ğŸ”„ Adapt |
| `VoiceButton.tsx` | Rewrite in React Native View/Pressable | ğŸ”„ New component |
| `MessageFeed.tsx` | Rewrite with RN `FlatList` | ğŸ”„ New component |
| `StatusBar.tsx` | Adapt with RN `StatusBar` | ğŸ”„ Minor adapt |
| `App.css` | Replace with StyleSheet | âŒ Not portable |

### Key Dependencies for P3.1 Scaffold
```json
{
  "expo": "^52.0.0",
  "expo-av": "~15.0.2",         // TTS audio playback + background audio
  "expo-audio": "~0.3.0",       // Microphone access (modern API)
  "expo-speech": "~13.0.0",     // Native TTS fallback (on-device)
  "expo-notifications": "~0.29.9", // Proactive push (P3 requirement)
  "expo-router": "~4.0.0",      // File-based navigation
  "@expo/vector-icons": "^14.0.0"
}
```

### Background Audio Mode (P3.2 Preview)
**iOS:** Requires `Info.plist` â†’ `UIBackgroundModes: ["audio"]`
In Expo: add to `app.json`:
```json
{
  "expo": {
    "ios": {
      "infoPlist": {
        "UIBackgroundModes": ["audio"]
      }
    }
  }
}
```
**Android:** `expo-av` with `staysActiveInBackground: true` in Audio session config.

### Wake Word / Always-Listening (P3.3 Preview)
**Hard Truth:** True always-listening is severely restricted on iOS without a VoIP entitlement.
**Recommended approach:**
- Use **lock screen widget** or **notification tap** to activate OVI
- Hold-to-talk on main screen (same as PWA UX)  
- Background: receive proactive notifications from OpenClaw, tap to speak back
- **Stretch goal:** Investigate `picovoice` React Native SDK (wake word on-device, works in background on both platforms)

### Cyberscape Hex View (P3.4 Preview)
- `react-native-skia` or `@shopify/react-native-skia` â€” hardware-accelerated 2D drawing
- Hexagonal grid: can port the concept from Cyberscape.md using Skia path rendering
- Alternative: Three.js in a WebView (faster to prototype, lower performance)

### Scaffold Structure (target for P3.1)
```
sparks/ovi-native/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ _layout.tsx        # Root layout (expo-router)
â”‚   â”œâ”€â”€ index.tsx          # Main OVI voice screen
â”‚   â””â”€â”€ cyberscape.tsx     # Hex view screen (P3.4)
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ VoiceButton.tsx    # RN press-and-hold
â”‚   â”œâ”€â”€ MessageFeed.tsx    # FlatList conversation
â”‚   â””â”€â”€ HexGrid.tsx        # Cyberscape view (P3.4)
â”œâ”€â”€ hooks/
â”‚   â”œâ”€â”€ useOVI.ts          # Ported from PWA (direct copy)
â”‚   â”œâ”€â”€ useTTS.ts          # expo-av version
â”‚   â””â”€â”€ useSpeech.ts       # expo-audio version
â”œâ”€â”€ app.json               # Expo config (background audio, permissions)
â””â”€â”€ package.json
```

### Decision for Next Heartbeat
**P3.1 is unblocked.** Research complete. Execute:
1. `npx create-expo-app@latest ovi-native --template blank-typescript`
2. Install deps: `expo-av`, `expo-audio`, `expo-router`, `expo-notifications`
3. Copy `useOVI.ts` from PWA
4. Scaffold directory structure above
5. Commit `app.json` with background audio config

---

*Research Mode complete. P3.1 ready to build at next heartbeat.*
